<!DOCTYPE html>

<html>
    <head>
        <title>MONYMARKET</title>
        <link 
            rel="stylesheet"
            href="style.css"
            >
        <link rel="shortcut icon" type="image/png" width="32px" href="public/favicon-32x32.png"/>
        <link rel="icon" type="image/png" sizes="16x16" href="public/favicon-16x16.png"/>
        <meta http-equiv="Permissions-Policy" content="interest-cohort=()">

        <script src="https://unpkg.com/web3@1.8.2/dist/web3.min.js"></script>

        <script>
        const fetchNFTData = async () => {
            const apiKey = '<API-KEY>';
            const apiKeySecret = '<API-KEY-SECRET>';
            const nftUrl = 'https://nft.api.infura.io/networks/1/nfts/0xa9cb55d05d3351dcd02dd5dc4614e764ce3e1d6e/tokens/7421?resyncMetadata=false';
            
            const response = await fetch(nftUrl, {
              headers: {
                'Authorization': `Basic ${btoa(`${apiKey}:${apiKeySecret}`)}`,
                'Accept': 'application/json'
              }
            });
          
            if (response.ok) {
              const data = await response.json();
              // Handle the response data
              console.log(data);
            } else {
              console.error('Error:', response.status, response.statusText);
            }
          };
          
          
        </script>
    </head>
    <!-- dropdown -->
    <script>
        // Select all dropdown parent elements
        var dropdownParents = document.querySelectorAll('.dropdown');
      
        // Add click event listener to each dropdown parent
        dropdownParents.forEach(function (parent) {
          parent.addEventListener('click', function () {
            // Toggle the "active" class on the clicked dropdown parent
            this.classList.toggle('active');
      
            // Toggle the visibility of the dropdown content
            var dropdownContent = this.querySelector('.dropitems');
            dropdownContent.classList.toggle('show');
          });
        });
      
        // Close the dropdown when clicking outside of it
        window.addEventListener('click', function (event) {
          dropdownParents.forEach(function (parent) {
            if (!parent.contains(event.target)) {
              parent.classList.remove('active');
              var dropdownContent = parent.querySelector('.dropitems');
              dropdownContent.classList.remove('show');
            }
          });
        });
      </script>
    
    <body>
        
            <div class="toolbar">
                <div class="topbar">
                    <p>Mony</p>
                </div>
                <div class="menu">
                    <div class="logo">
                        <img src="public/logo.png"/>
                    </div>
                    <div class="options">
                        <ul>
                            <li>
                                <div class="dropdown">
                                    Collections
                                    <div class="dropitems">
                                        <a href="https://nftx.io/vault/0x855882cc65ba66cdbc7a8c512143f10169891307/buy/" target="_blank">MiladyStation</a>
                                        <a href="https://opensea.io/collection/cigstation" target="_blank">CigStation</a>
                                        <a href="https://opensea.io/collection/mony-missingno" target="_blank">MissingNo.</a>
                                    </div>
                                </div>
                            </li>

                            </li>
                            <li>                                
                                <div class="dropdown">
                                Games
                                    <div class="dropitems">
                                        <a href="https://miladycola.net" target="_blank">MiladyCola</a>
                                        <a href="https://monygroup.net/market" target="_blank">MonyMarket</a>
                                    </div>
                                </div>
                            </li>
                            <li>
                                <div class="dropdown">
                                Services
                                    <div class="dropitems">
                                        <a href="#">Smart Contract Development</a>
                                        <a href="#">Website Development</a>
                                        <a href="#">Audits</a>
                                    </div>
                                </div>
                            </li>
                            <li><a href="#">About Us</a></li>
                        </ul>
                    </div>
                    <div class="search">
                        <input placeholder="search"></input>
                    </div>
                </div>
            </div>
            

    <div>
        <h1>MONY MARKET</h1>
        <h3>Current Listings</h3>
        <ul id="listings"></ul>

    </div>

    <div class="footerwrap">
        <div class="footer">
            <div class="miladystationlogo">
                <img src="public/bwlogo.png" width="120px" height="90px"/>
            </div>
            <p class="footerblurb">Mony Group Corporation Website</p>
            <div class="footeroption">
                <ul>
                    <li>Home</li>
                    <li>Terms of Use</li>
                    <li>Privacy Policy</li>
                    <li>MiladyStation.Net</li>
                    <li>Contact Us</li>
                </ul>
            </div>
            <br/>
            <div class="footerfooter">
                <p class="copyleft">2023 Mony Group Corporation</p>
            </div>
        </div>
        
    </body>
    <script>
        console.log('version 16')
            //const provider = new Web3.givenProvider || new Web3.providers.WebsocketProvider('wss://mainnet.infura.io/ws/v3/51af642c93d846f7821865a7e3ab05d1');
            const web3 = new Web3(new Web3.providers.WebsocketProvider('wss://mainnet.infura.io/ws/v3/51af642c93d846f7821865a7e3ab05d1'));

            //console.log('givenProvider:',provider);
            
            //console.log('web3 object',web3)

            
            var accounts = [];
            //var friend; lets add this later for miladystation holders to buy and sell without a fee
            var listings = [];
            var listingCount = 0;
            var approveSell;
            var approveBuy;
            var connected = false;
            var gotProps = false;
            var chainScanPre = 'https://etherscan.io/tx/'

            const marketAddress = "0xAcd9b6C25704c4CdE7d8FBfcfF0eA41346B61E19";  //main

            const marketABI = [{"inputs":[],"name":"CurrencyAllowanceError","type":"error"},{"inputs":[],"name":"NewOwnerIsZeroAddress","type":"error"},{"inputs":[],"name":"NoHandoverRequest","type":"error"},{"inputs":[],"name":"SaleNotOn","type":"error"},{"inputs":[],"name":"TokenApprovalError","type":"error"},{"inputs":[],"name":"Unauthorized","type":"error"},{"inputs":[],"name":"YouDontOwn","type":"error"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"pendingOwner","type":"address"}],"name":"OwnershipHandoverCanceled","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"pendingOwner","type":"address"}],"name":"OwnershipHandoverRequested","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"oldOwner","type":"address"},{"indexed":true,"internalType":"address","name":"newOwner","type":"address"}],"name":"OwnershipTransferred","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"seller","type":"address"},{"indexed":false,"internalType":"address","name":"buyer","type":"address"},{"indexed":false,"internalType":"address","name":"collection","type":"address"},{"indexed":false,"internalType":"address","name":"currency","type":"address"},{"indexed":false,"internalType":"uint256","name":"tokenId","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"price","type":"uint256"}],"name":"Purchase","type":"event"},{"inputs":[{"internalType":"address","name":"collection","type":"address"}],"name":"approveIt1155","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"collection","type":"address"}],"name":"approveIt721","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"listingId","type":"uint256"}],"name":"buy","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"cancelOwnershipHandover","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"address","name":"pendingOwner","type":"address"}],"name":"completeOwnershipHandover","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"uint256","name":"erc","type":"uint256"},{"internalType":"address","name":"collection","type":"address"},{"internalType":"address","name":"currency","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"},{"internalType":"uint256","name":"price","type":"uint256"}],"name":"createListing","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"listingId","type":"uint256"}],"name":"deleteListing","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"listingCount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"listingList","outputs":[{"internalType":"bool","name":"saleOn","type":"bool"},{"internalType":"uint256","name":"erc","type":"uint256"},{"internalType":"address","name":"seller","type":"address"},{"internalType":"address","name":"collection","type":"address"},{"internalType":"address","name":"currency","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"},{"internalType":"uint256","name":"price","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"result","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"pendingOwner","type":"address"}],"name":"ownershipHandoverExpiresAt","outputs":[{"internalType":"uint256","name":"result","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"ownershipHandoverValidFor","outputs":[{"internalType":"uint64","name":"","type":"uint64"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"renounceOwnership","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[],"name":"requestOwnershipHandover","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"address","name":"newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"stateMutability":"payable","type":"function"}];

            const market = new web3.eth.Contract(marketABI,marketAddress);

            //functions
                getProps = async() => {
                    for(i=0;i<2;i++){
                        await getListing(i);
                        updateListings(i);
                        try {
                            //count = await rejects.methods.count().call();
                            //holder = await rejects.methods.holderMints(accounts[0]).call();
                            // update page to show count
                            //var prog = get('count');
                            //prog.innerHTML = `${count}/123`
                        } catch (err) {
                            console.log('prop err:',err)
                        }
                    }
                    
                    gotProps = true;
                }
                getListing = async(id) => {
                    
                    var listing = {
                        saleOn: false,
                        erc: -1,
                        seller: 0x0000000000000000000000000000,
                        collection: 0x0000000000000000000000000000,
                        currency: 0x0000000000000000000000000000,
                        tokenId: -1,
                        price: -1
                    }

                    try {
                        
                        var currentListing = await market.methods.listingList(id).call();
                        
                        listing = currentListing;
                    } catch (err) {
                        console.log('fail:::::',err)
                    }
                    
                    listings[listingCount] = listing;
                    
                    listingCount++;
                }
                updateListings = async(id) => {
                    var listlist = document.getElementById('listings');
                    console.log('tokenId check:',listings[id].tokenId)
                    listlist.innerHTML += `<li>${listings[id].tokenId}</li>`
                } 
                getProps();
                
        </script>
    
</html>