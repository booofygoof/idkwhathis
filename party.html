<!DOCTYPE html>
<html>
    <head>
        <title>DJ Booth</title>
        <link rel="stylesheet" href="style.css" />
        <link rel="shortcut icon" type="image/png" width="32px" href="public/favicon-32x32.png"/>
        <link rel="icon" type="image/png" sizes="16x16" href="public/favicon-16x16.png"/>
        <meta http-equiv="Permissions-Policy" content="interest-cohort=()">
        <script src="./partyHat.js"></script>
        <script src="https://unpkg.com/web3@1.10.0/dist/web3.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/bignumber.js/9.1.1/bignumber.min.js" integrity="sha512-RDkOXE/q9gnuJ/SUl8bUwbYOOXO8orhgIucuMbm3Wk8dtA/cNaUnWYrDONUwWsR//QmuPEIKyyudaP0c+EmMOQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
        
        <!-- metadata fetch -->
        <!-- <script>
            let fetchNFTData = async (collection, id) => {
                //if u steal this fuk u
                const apiKey = "51af642c93d846f7821865a7e3ab05d1";
                const apiKeySecret = "806aff78b8b94437a04ee0b13d5d0612";
                const nftUrl = `https://nft.api.infura.io/networks/1/nfts/${collection}/tokens/${id}?resyncMetadata=false`;
                
                const response = await fetch(nftUrl, {
                headers: {
                    'Authorization': `Basic ${btoa(`${apiKey}:${apiKeySecret}`)}`,
                    'Accept': 'application/json'
                }
                });
            
                if (response.ok) {
                const data = await response.json();
                // Handle the response data
                //console.log(data);
                return data;
                } else {
                console.error('Fetch Error:', response.status, response.statusText);
                }
            };
            function editCID (meta) {
                console.log('we are get meta picture here:',meta);
                return meta.slice(6)
            }
        </script> -->
        <!-- frontend stuff -->
        <script>
            //Dropdown
                // Select all dropdown parent elements
                var dropdownParents = document.querySelectorAll('.dropdown');
            
                // Add click event listener to each dropdown parent
                dropdownParents.forEach(function (parent) {
                parent.addEventListener('click', function () {
                    // Toggle the "active" class on the clicked dropdown parent
                    this.classList.toggle('active');
            
                    // Toggle the visibility of the dropdown content
                    var dropdownContent = this.querySelector('.dropitems');
                    dropdownContent.classList.toggle('show');
                });
                });
            
                // Close the dropdown when clicking outside of it
                window.addEventListener('click', function (event) {
                dropdownParents.forEach(function (parent) {
                    if (!parent.contains(event.target)) {
                    parent.classList.remove('active');
                    var dropdownContent = parent.querySelector('.dropitems');
                    dropdownContent.classList.remove('show');
                    }
                });
                });
            //Popup
                function closePop(which) {
                    var pop;
                    switch(which){
                        case 1:
                            pop = document.getElementById('pop');
                            break;
                        case 2:
                            pop = document.getElementById('pop2');
                            break;
                        case 3:
                            pop = document.getElementById('pop3');
                            break;
                        default:
                            pop = document.getElementById('pop');
                            break;
                    }
                    pop.innerHTML = '';
                    pop.style.display = 'none';
                }
                showPop = (which) => {
                    var pop;
                    switch(which){
                        case 1:
                            pop = document.getElementById('pop');
                            pop.innerHTML += '<div class="x" onclick="closePop(1)">x</div>'
                            break;
                        case 2:
                            pop = document.getElementById('pop2');
                            pop.innerHTML += '<div class="x" onclick="closePop(2)">x</div>'
                            break;
                        case 3:
                            pop = document.getElementById('pop3');
                            // pop.innerHTML += '<div class="x" onclick="closePop(3)">x</div>'
                            break;
                    }
                    pop.style.display = 'block';
                }
                popPop = (innerHTML,which) => {
                    var pop;
                    switch(which){
                        case 0:
                            pop = document.getElementById('dashboard');
                            pop.innerHTML = innerHTML;
                            break;
                        case 1:
                            pop = document.getElementById('pop');
                            pop.innerHTML = '<div class="x" onclick="closePop(1)">x</div>'+innerHTML;
                            break;
                        case 2:
                            pop = document.getElementById('pop2');
                            pop.innerHTML = '<div class="x" onclick="closePop(2)">x</div>'+innerHTML;
                            break;
                        case 3:
                            pop = document.getElementById('pop3');
                            pop.innerHTML = '<div class="x" onclick="closePop(3)">x</div>'+innerHTML;
                            break;
                    } 
                }
            //Get
                function get(id) {
                   return document.getElementById(id);
                }
            //TX Receipt
            function gibReceipt(tx,desc) {

                    var innerHTML = 
                        `
                        <img id="cashier" src="public/milkbar1.png"/>
                        <div id="receipt">
                            <h3 class="center">Congratulations! You have just ${desc}</h3>
                            <p class="center">You can see your transaction here:</p>
                            <a class="center white-link" target="_blank" href="https://etherscan.io/tx/${tx}">${tx}</a>
                        </div>
                        `;
                    popPop(innerHTML,3);
                    showPop(3);
                }
        </script>
    </head>

    
    <body>
        
        <div class="toolbar">
            <div class="topbar">
                <p>Mony</p>
            </div>
            <div class="menu">
                <div class="logo">
                    <img src="public/logo.png"/>
                </div>
                <div class="options">
                    <ul>
                        <li>
                            <div class="dropdown">
                                Collections
                                <div class="dropitems">
                                    <a href="https://nftx.io/vault/0x855882cc65ba66cdbc7a8c512143f10169891307/buy/" target="_blank">MiladyStation</a>
                                    <a href="https://opensea.io/collection/cigstation" target="_blank">CigStation</a>
                                    <a href="https://opensea.io/collection/mony-missingno" target="_blank">MissingNo.</a>
                                </div>
                            </div>
                        </li>

                        </li>
                        <li>                                
                            <div class="dropdown">
                            Consoles
                                <div class="dropitems">
                                    <a href="https://miladycola.net" target="_blank">MiladyCola</a>
                                    <a href="https://monygroup.net/market" target="_blank">MonyMarket</a>
                                </div>
                            </div>
                        </li>
                        <li>
                            <div class="dropdown">
                            Services
                                <div class="dropitems">
                                    <a href="https://mony-group-lending.bancof.io/borrower/dashboard" target="_blank" >Collateralized Loans</a>
                                    <a href="mailto:monygroupcorporation+monygrouponline@gmail.com?subject=Dev%20Work&body=I%20want%20you%20to%20make%20me%20a%20contract">Smart Contract Development</a>
                                    <a href="mailto:monygroupcorporation+monygrouponline@gmail.com?subject=Dev%20Work&body=I%20want%20you%20to%20make%20me%20a%20website">Website Development</a>
                                    <a href="mailto:monygroupcorporation+monygrouponline@gmail.com?subject=Dev%20Work&body=I%20want%20you%20to%20audit%20my%20project">Audits</a>
                                </div>
                            </div>
                        </li>
                        <li><a href="#">About Us</a></li>
                    </ul>
                </div>
                <div class="search">
                    <input placeholder="search"></input>
                </div>
            </div>
        </div>
            
        <div id="raffle">
            <div class="collectibles">
                <h1>Milady Maker Party HQ</h1>
                <div id="dashboard">
                    <button id="connect" onclick="partyFlow()">Let's Party B^]</button>
                    <div id="locked"></div>
                </div>
            </div>
        </div>

        <div id="pop"></div>
        <div id="pop2"></div>
        <div id="pop3"></div>

        <div class="footerwrap">
            <div class="footer">
                <div class="miladystationlogo">
                    <img src="public/bwlogo.png" width="120px" height="90px"/>
                </div>
                <p class="footerblurb">Mony Group Corporation Website</p>
                <div class="footeroption">
                    <ul>
                        <li>Home</li>
                        <li>Terms of Use</li>
                        <li>Privacy Policy</li>
                        <li>MiladyStation.Net</li>
                        <li>Contact Us</li>
                    </ul>
                </div>
                <br/>
                <div class="footerfooter">
                    <p class="copyleft">2023 Mony Group Corporation</p>
                </div>
            </div>
        </div>
        
        <!-- web3 -->
        <script>
            console.log('version 19')
                
                    
                var web33 = new Web3(new Web3.providers.WebsocketProvider('wss://mainnet.infura.io/ws/v3/51af642c93d846f7821865a7e3ab05d1'));
                //test
                var web3 = new Web3(new Web3.providers.WebsocketProvider('wss://sepolia.infura.io/ws/v3/51af642c93d846f7821865a7e3ab05d1'));
            
                var connected = false;
                var accounts = [];
                const admin = '0x6A0a993cc824457734EC7Cac50744a34EcAf34D4';
                //test
                const creationHash = '0xa699588b268be353911a65731e5769f93e58fe92dd17e17597edbda8e36ce41f';

                var time;
                var winnerMCount;
                var winnerRCount;
                var winnerPCount;

                var randomness = [];

                var loaded = false;
                var locked = false;

                

                var gotProps = false;
                var chainScanPre = 'https://etherscan.io/tx/'
    
                const partyRaffleAddress = "0xfB6798e50b0618C5013a26eb61fb51cbdB13c615";  //sepolia 2
                const partyRaffleABI = 
                [{"inputs":[{"internalType":"uint64","name":"subscriptionId","type":"uint64"}],"stateMutability":"nonpayable","type":"constructor"},{"inputs":[{"internalType":"address","name":"have","type":"address"},{"internalType":"address","name":"want","type":"address"}],"name":"OnlyCoordinatorCanFulfill","type":"error"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"}],"name":"OwnershipTransferRequested","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"}],"name":"OwnershipTransferred","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"playa","type":"address"},{"indexed":false,"internalType":"uint256","name":"requestId","type":"uint256"},{"indexed":false,"internalType":"uint256[]","name":"randomWords","type":"uint256[]"}],"name":"RequestFulfilled","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"requestId","type":"uint256"},{"indexed":false,"internalType":"uint32","name":"numWords","type":"uint32"}],"name":"RequestSent","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256[]","name":"rando","type":"uint256[]"}],"name":"loaded","type":"event"},{"inputs":[],"name":"_miladyXAddress","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"_mmpAddress","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"_pixeladyXAddress","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"_remilioXAddress","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"acceptOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"winner","type":"address"}],"name":"blackCheck","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"pure","type":"function"},{"inputs":[],"name":"checkCoin","outputs":[{"internalType":"uint256[3]","name":"","type":"uint256[3]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint32","name":"numWin","type":"uint32"}],"name":"drawPrize","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_requestId","type":"uint256"}],"name":"getRequestStatus","outputs":[{"internalType":"bool","name":"fulfilled","type":"bool"},{"internalType":"uint256[]","name":"randomWords","type":"uint256[]"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"lastRequestId","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"miladyWinnerCount","outputs":[{"internalType":"uint16","name":"","type":"uint16"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"pixeladyWinnerCount","outputs":[{"internalType":"uint16","name":"","type":"uint16"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"randomness","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"range","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"requestId","type":"uint256"},{"internalType":"uint256[]","name":"randomWords","type":"uint256[]"}],"name":"rawFulfillRandomWords","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"remilioWinnerCount","outputs":[{"internalType":"uint16","name":"","type":"uint16"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"requestIds","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"s_requests","outputs":[{"internalType":"bool","name":"fulfilled","type":"bool"},{"internalType":"bool","name":"exists","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256[]","name":"tokenId","type":"uint256[]"},{"internalType":"uint8[]","name":"which","type":"uint8[]"}],"name":"sendIt","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint32","name":"newGas","type":"uint32"}],"name":"setGasLimit","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"to","type":"address"}],"name":"transferOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"withdrawCoins","outputs":[],"stateMutability":"nonpayable","type":"function"}];
                var raffle = new web3.eth.Contract(partyRaffleABI,partyRaffleAddress);

                // mainnet
                const mmpAddress = "0x05C63282c87f620aF5a658cBb53548257F3A6186";
                const mmpABI = 
                [{"inputs":[],"name":"ApprovalCallerNotOwnerNorApproved","type":"error"},{"inputs":[],"name":"ApprovalQueryForNonexistentToken","type":"error"},{"inputs":[],"name":"BalanceQueryForZeroAddress","type":"error"},{"inputs":[],"name":"InvalidConfig","type":"error"},{"inputs":[],"name":"LockedForever","type":"error"},{"inputs":[],"name":"MaxSupplyExceeded","type":"error"},{"inputs":[],"name":"MintERC2309QuantityExceedsLimit","type":"error"},{"inputs":[],"name":"MintToZeroAddress","type":"error"},{"inputs":[],"name":"MintZeroQuantity","type":"error"},{"inputs":[],"name":"NotPlatform","type":"error"},{"inputs":[],"name":"NotTokenOwner","type":"error"},{"inputs":[],"name":"OwnerQueryForNonexistentToken","type":"error"},{"inputs":[],"name":"OwnershipNotInitializedForExtraData","type":"error"},{"inputs":[],"name":"TransferCallerNotOwnerNorApproved","type":"error"},{"inputs":[],"name":"TransferFromIncorrectOwner","type":"error"},{"inputs":[],"name":"TransferToNonERC721ReceiverImplementer","type":"error"},{"inputs":[],"name":"TransferToZeroAddress","type":"error"},{"inputs":[],"name":"URIQueryForNonexistentToken","type":"error"},{"inputs":[],"name":"WrongPassword","type":"error"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"approved","type":"address"},{"indexed":true,"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"Approval","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"operator","type":"address"},{"indexed":false,"internalType":"bool","name":"approved","type":"bool"}],"name":"ApprovalForAll","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"fromTokenId","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"toTokenId","type":"uint256"},{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"}],"name":"ConsecutiveTransfer","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint8","name":"version","type":"uint8"}],"name":"Initialized","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"key","type":"bytes32"},{"indexed":true,"internalType":"bytes32","name":"cid","type":"bytes32"}],"name":"Invited","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"previousOwner","type":"address"},{"indexed":true,"internalType":"address","name":"newOwner","type":"address"}],"name":"OwnershipTransferred","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"affiliate","type":"address"},{"indexed":false,"internalType":"address","name":"token","type":"address"},{"indexed":false,"internalType":"uint128","name":"wad","type":"uint128"},{"indexed":false,"internalType":"uint256","name":"numMints","type":"uint256"}],"name":"Referral","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":true,"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"Transfer","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"src","type":"address"},{"indexed":false,"internalType":"address","name":"token","type":"address"},{"indexed":false,"internalType":"uint128","name":"wad","type":"uint128"}],"name":"Withdrawal","type":"event"},{"inputs":[{"internalType":"address","name":"affiliate","type":"address"}],"name":"affiliateBalance","outputs":[{"internalType":"uint128","name":"","type":"uint128"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"affiliate","type":"address"},{"internalType":"address","name":"token","type":"address"}],"name":"affiliateBalanceToken","outputs":[{"internalType":"uint128","name":"","type":"uint128"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"operator","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"approve","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"components":[{"internalType":"bytes32","name":"key","type":"bytes32"},{"internalType":"bytes32[]","name":"proof","type":"bytes32[]"}],"internalType":"struct Auth","name":"auth","type":"tuple"},{"internalType":"address[]","name":"toList","type":"address[]"},{"internalType":"uint256[]","name":"quantityList","type":"uint256[]"},{"internalType":"address","name":"affiliate","type":"address"},{"internalType":"bytes","name":"signature","type":"bytes"}],"name":"batchMintTo","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[],"name":"burnConfig","outputs":[{"internalType":"contract IERC721AUpgradeable","name":"archetype","type":"address"},{"internalType":"bool","name":"enabled","type":"bool"},{"internalType":"bool","name":"reversed","type":"bool"},{"internalType":"uint16","name":"ratio","type":"uint16"},{"internalType":"uint64","name":"start","type":"uint64"},{"internalType":"uint64","name":"limit","type":"uint64"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256[]","name":"tokenIds","type":"uint256[]"}],"name":"burnToMint","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"config","outputs":[{"internalType":"string","name":"baseUri","type":"string"},{"internalType":"address","name":"affiliateSigner","type":"address"},{"internalType":"address","name":"ownerAltPayout","type":"address"},{"internalType":"address","name":"superAffiliatePayout","type":"address"},{"internalType":"uint32","name":"maxSupply","type":"uint32"},{"internalType":"uint32","name":"maxBatchSize","type":"uint32"},{"internalType":"uint16","name":"affiliateFee","type":"uint16"},{"internalType":"uint16","name":"platformFee","type":"uint16"},{"internalType":"uint16","name":"defaultRoyalty","type":"uint16"},{"components":[{"internalType":"uint16","name":"affiliateDiscount","type":"uint16"},{"components":[{"internalType":"uint16","name":"numMints","type":"uint16"},{"internalType":"uint16","name":"mintDiscount","type":"uint16"}],"internalType":"struct MintTier[]","name":"mintTiers","type":"tuple[]"}],"internalType":"struct Discount","name":"discounts","type":"tuple"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"disableBurnToMint","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"disableRoyaltyEnforcement","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"archetype","type":"address"},{"internalType":"bool","name":"reversed","type":"bool"},{"internalType":"uint16","name":"ratio","type":"uint16"},{"internalType":"uint64","name":"start","type":"uint64"},{"internalType":"uint64","name":"limit","type":"uint64"}],"name":"enableBurnToMint","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"enableRoyaltyEnforcement","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"getApproved","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"getTokenMsg","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"string","name":"name","type":"string"},{"internalType":"string","name":"symbol","type":"string"},{"components":[{"internalType":"string","name":"baseUri","type":"string"},{"internalType":"address","name":"affiliateSigner","type":"address"},{"internalType":"address","name":"ownerAltPayout","type":"address"},{"internalType":"address","name":"superAffiliatePayout","type":"address"},{"internalType":"uint32","name":"maxSupply","type":"uint32"},{"internalType":"uint32","name":"maxBatchSize","type":"uint32"},{"internalType":"uint16","name":"affiliateFee","type":"uint16"},{"internalType":"uint16","name":"platformFee","type":"uint16"},{"internalType":"uint16","name":"defaultRoyalty","type":"uint16"},{"components":[{"internalType":"uint16","name":"affiliateDiscount","type":"uint16"},{"components":[{"internalType":"uint16","name":"numMints","type":"uint16"},{"internalType":"uint16","name":"mintDiscount","type":"uint16"}],"internalType":"struct MintTier[]","name":"mintTiers","type":"tuple[]"}],"internalType":"struct Discount","name":"discounts","type":"tuple"}],"internalType":"struct Config","name":"config_","type":"tuple"},{"internalType":"address","name":"_receiver","type":"address"}],"name":"initialize","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"name":"invites","outputs":[{"internalType":"uint128","name":"price","type":"uint128"},{"internalType":"uint128","name":"reservePrice","type":"uint128"},{"internalType":"uint128","name":"delta","type":"uint128"},{"internalType":"uint32","name":"start","type":"uint32"},{"internalType":"uint32","name":"end","type":"uint32"},{"internalType":"uint32","name":"limit","type":"uint32"},{"internalType":"uint32","name":"maxSupply","type":"uint32"},{"internalType":"uint32","name":"interval","type":"uint32"},{"internalType":"uint32","name":"unitSize","type":"uint32"},{"internalType":"address","name":"tokenAddress","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"address","name":"operator","type":"address"}],"name":"isApprovedForAll","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"key","type":"bytes32"}],"name":"listSupply","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"string","name":"password","type":"string"}],"name":"lockAffiliateFee","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"password","type":"string"}],"name":"lockDiscounts","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"password","type":"string"}],"name":"lockMaxSupply","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"password","type":"string"}],"name":"lockOwnerAltPayout","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"password","type":"string"}],"name":"lockProvenanceHash","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"password","type":"string"}],"name":"lockRoyaltyEnforcement","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"password","type":"string"}],"name":"lockURI","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"components":[{"internalType":"bytes32","name":"key","type":"bytes32"},{"internalType":"bytes32[]","name":"proof","type":"bytes32[]"}],"internalType":"struct Auth","name":"auth","type":"tuple"},{"internalType":"uint256","name":"quantity","type":"uint256"},{"internalType":"address","name":"affiliate","type":"address"},{"internalType":"bytes","name":"signature","type":"bytes"}],"name":"mint","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[{"components":[{"internalType":"bytes32","name":"key","type":"bytes32"},{"internalType":"bytes32[]","name":"proof","type":"bytes32[]"}],"internalType":"struct Auth","name":"auth","type":"tuple"},{"internalType":"uint256","name":"quantity","type":"uint256"},{"internalType":"address","name":"to","type":"address"},{"internalType":"address","name":"affiliate","type":"address"},{"internalType":"bytes","name":"signature","type":"bytes"}],"name":"mintTo","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"address","name":"minter","type":"address"},{"internalType":"bytes32","name":"key","type":"bytes32"}],"name":"minted","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"name","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"options","outputs":[{"internalType":"bool","name":"uriLocked","type":"bool"},{"internalType":"bool","name":"maxSupplyLocked","type":"bool"},{"internalType":"bool","name":"affiliateFeeLocked","type":"bool"},{"internalType":"bool","name":"discountsLocked","type":"bool"},{"internalType":"bool","name":"ownerAltPayoutLocked","type":"bool"},{"internalType":"bool","name":"royaltyEnforcementEnabled","type":"bool"},{"internalType":"bool","name":"royaltyEnforcementLocked","type":"bool"},{"internalType":"bool","name":"provenanceHashLocked","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"ownerBalance","outputs":[{"components":[{"internalType":"uint128","name":"owner","type":"uint128"},{"internalType":"uint128","name":"platform","type":"uint128"}],"internalType":"struct OwnerBalance","name":"","type":"tuple"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"token","type":"address"}],"name":"ownerBalanceToken","outputs":[{"components":[{"internalType":"uint128","name":"owner","type":"uint128"},{"internalType":"uint128","name":"platform","type":"uint128"}],"internalType":"struct OwnerBalance","name":"","type":"tuple"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"ownerOf","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"platform","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"pure","type":"function"},{"inputs":[],"name":"provenance","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"renounceOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_tokenId","type":"uint256"},{"internalType":"uint256","name":"_salePrice","type":"uint256"}],"name":"royaltyInfo","outputs":[{"internalType":"address","name":"","type":"address"},{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"safeTransferFrom","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"},{"internalType":"bytes","name":"data","type":"bytes"}],"name":"safeTransferFrom","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"uint16","name":"affiliateFee","type":"uint16"}],"name":"setAffiliateFee","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"operator","type":"address"},{"internalType":"bool","name":"approved","type":"bool"}],"name":"setApprovalForAll","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"baseUri","type":"string"}],"name":"setBaseURI","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"receiver","type":"address"},{"internalType":"uint16","name":"feeNumerator","type":"uint16"}],"name":"setDefaultRoyalty","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"components":[{"internalType":"uint16","name":"affiliateDiscount","type":"uint16"},{"components":[{"internalType":"uint16","name":"numMints","type":"uint16"},{"internalType":"uint16","name":"mintDiscount","type":"uint16"}],"internalType":"struct MintTier[]","name":"mintTiers","type":"tuple[]"}],"internalType":"struct Discount","name":"discounts","type":"tuple"}],"name":"setDiscounts","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"_key","type":"bytes32"},{"internalType":"bytes32","name":"_cid","type":"bytes32"},{"components":[{"internalType":"uint128","name":"price","type":"uint128"},{"internalType":"uint128","name":"reservePrice","type":"uint128"},{"internalType":"uint128","name":"delta","type":"uint128"},{"internalType":"uint32","name":"start","type":"uint32"},{"internalType":"uint32","name":"end","type":"uint32"},{"internalType":"uint32","name":"limit","type":"uint32"},{"internalType":"uint32","name":"maxSupply","type":"uint32"},{"internalType":"uint32","name":"interval","type":"uint32"},{"internalType":"uint32","name":"unitSize","type":"uint32"},{"internalType":"address","name":"tokenAddress","type":"address"}],"internalType":"struct DutchInvite","name":"_dutchInvite","type":"tuple"}],"name":"setDutchInvite","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"_key","type":"bytes32"},{"internalType":"bytes32","name":"_cid","type":"bytes32"},{"components":[{"internalType":"uint128","name":"price","type":"uint128"},{"internalType":"uint32","name":"start","type":"uint32"},{"internalType":"uint32","name":"end","type":"uint32"},{"internalType":"uint32","name":"limit","type":"uint32"},{"internalType":"uint32","name":"maxSupply","type":"uint32"},{"internalType":"uint32","name":"unitSize","type":"uint32"},{"internalType":"address","name":"tokenAddress","type":"address"}],"internalType":"struct Invite","name":"_invite","type":"tuple"}],"name":"setInvite","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint32","name":"maxBatchSize","type":"uint32"}],"name":"setMaxBatchSize","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint32","name":"maxSupply","type":"uint32"},{"internalType":"string","name":"password","type":"string"}],"name":"setMaxSupply","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"ownerAltPayout","type":"address"}],"name":"setOwnerAltPayout","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"provenanceHash","type":"string"}],"name":"setProvenanceHash","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"superAffiliatePayout","type":"address"}],"name":"setSuperAffiliatePayout","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"},{"internalType":"string","name":"message","type":"string"}],"name":"setTokenMsg","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes4","name":"interfaceId","type":"bytes4"}],"name":"supportsInterface","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"symbol","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"tokenURI","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalSupply","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"transferFrom","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"address","name":"newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"withdraw","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address[]","name":"tokens","type":"address[]"}],"name":"withdrawTokens","outputs":[],"stateMutability":"nonpayable","type":"function"}];
                var mmp = new web33.eth.Contract(mmpABI,mmpAddress);
    
                //functions
                    //Site+Contract logic
                    getProps = async() => {
                        var meta;
                        
                        try{
                            let block = await web3.eth.getTransaction(creationHash)
                            time = await web3.eth.getBlock(block.blockNumber);
                            time = time.timestamp;
                            console.log('time in props',time)
                            winnerMCount = await raffle.methods.miladyWinnerCount().call();
                            winnerRCount = await raffle.methods.remilioWinnerCount().call();
                            winnerPCount = await raffle.methods.pixeladyWinnerCount().call();
                            randomness[0] = await raffle.methods.randomness(0).call();
                            randomness[1] = await raffle.methods.randomness(1).call();
                            //randomness[2] = await raffle.methods.randomness(2).call();
                            //randomness[3] = await raffle.methods.randomness(3).call();
                            //randomness[4] = await raffle.methods.randomness(4).call();
                            //randomness[5] = await raffle.methods.randomness(5).call();
                        } catch (err) {
                            console.log('props getter err',err);
                        }

                        let randcount = 0;
                        for(let i = 0; i<6; i++){
                            if(randomness[i]){
                                randcount++;
                            }
                        }
                        console.log('randcount',randcount);
                        if(randcount>0){
                            loaded = true;
                        }
                        
                        
                        gotProps = true;
                    }
                    popProps = async () => {

                        let times = get('time');
                        let mWin = get('mWin');
                        let rWin = get('rWin');
                        let pWin = get('pWin');
                        let dash = get('dashboard');
                        let win1 = get('wallet1');
                        let win2 = get('wallet2');
                        let win3 = get('wallet3');
                        console.log(time);
                        let currentTimestamp = Math.floor(Date.now() / 1000);
                        console.log(currentTimestamp);
                        let ageInSeconds = currentTimestamp - time;
                        console.log(ageInSeconds);
                        let ageInMinutes = ageInSeconds / 60;
                        console.log(ageInMinutes);
                        let ageInHours = ageInMinutes / 60;
                        console.log(ageInHours);
                        
                        times.innerHTML = "Partying for "+ageInHours+" Hours";
                        mWin.innerHTML = "This many milady won: "+winnerMCount;
                        rWin.innerHTML = "This many Remilio won: "+winnerRCount;
                        pWin.innerHTML = "This many Pixelady won: "+winnerPCount;
                        
                        if(!loaded){
                            dashboard.innerHTML += `
                            <div id="loaded">
                                <button onclick="drawFlow()">Draw</button>
                            </div>
                            `
                        } else {
                            //we have randomness
                            console.log(randomness);

                            let id = await getId(1);

                            console.log(id);

                            win1.innerHTML = await getHolder( id );
                            if(randomness.length > 2){
                                win2.innerHTML = getHolder(getId(2));
                            } 
                            if(randomness.length > 4){
                                win3.innerHTML = getHolder(getId(3));
                            }
                            
                        }
                        if(!locked){

                        }

                    }
                    getProps();
                    
                    //Raffle Logic
                    getHolder = async (id) => {
                        let addy;
                        try {
                            addy = await mmp.methods.ownerOf(id).call();
                        } catch(err) {
                            console.log('get holder error:::',err);
                        }
                    }
                    getId = (which) => {
                        let id;
                        switch(which){
                            case 1:
                            id = randomness[0] + randomness[1];
                            if(id>partyHat.length){
                                id = id - partyHat.length;
                            }
                            return id;
                            break;
                            case 2:
                            id = randomness[2] + randomness[3];
                            if(id>partyHat.length){
                                id = id - partyHat.length;
                            }
                            return id;
                            break;
                            case 3:
                            id = randomness[4] + randomness[5];
                            if(id>partyHat.length){
                                id = id - partyHat.length;
                            }
                            return id;
                            break;
                        }
                        
                        
                    }
                    countId = (id,which) => {
                        switch (which) {
                            case 1:
                                id = id + randomness[1]
                                if(id > partyHat.length){
                                    id = id - partyHat.length;
                                }
                                return id;
                                break;
                            case 2:
                                id = id + randomness[3]
                                if(id > partyHat.length){
                                    id = id - partyHat.length;
                                }
                                return id;
                                break;
                            case 3:
                                id = id + randomness[5]
                                if(id > partyHat.length){
                                    id = id - partyHat.length;
                                }
                                return id;
                                break;
                        }
                        
                    }
                    isX = (addy) => {
                        if(addy == nftxAdd){
                            return true;
                        } else {
                            return false;
                        }
                    }
                    //User logic
                    //gets accounts and checks chain id then sends to checkWallet()
                    connectWallet = async(flowSwitch) => {
                        web3 = new Web3(Web3.givenProvider);
                        raffle = new web3.eth.Contract(partyRaffleABI,partyRaffleAddress);
                        //mmp = new web3.eth.Contract(msABI,msAddress);
                        try {
                            accounts = await web3.eth.requestAccounts().then()
                            if(accounts[0]){
                                connected = true;
                            }
                        } catch(err) {
                            console.log('connectWallet requestAccounts error',err.message);
                        }
                        if(connected){
                            var networkId = await web3.eth.net.getId();
                            
                            if (networkId !== 11155111) {
                                alert('change your network to sepolia ethereum')
                            }
                            var connect = document.getElementById('connect');
                            connect.innerHTML = 'Connected';
                            connect.disabled = true;
                            connect.style.display = 'none';
                            //checkWallet should see miladystation holder
                            checkWallet();
                        }
                        var pop = document.getElementById('pop');
                        if(pop.style.display != 'none' || pop.style.display != ''){
                            switch(flowSwitch){
                                //no flow
                                case 0: 
                                    partyFlow();
                                    break;
                            } 
                        }
                    }
                    //checks miladystation holder just for website stuff, merkle in market contract is line of defense
                    checkWallet = async() => {
                        //mmp host check
                        //testing as miladycola host
                        if(accounts[0] == admin){
                            friend = true;
                        }
                        closePop(1);
                        // if(friend) {
                        //     partyFlow();
                        // }
                        
                    }
                    //user clicks buy button, needs to check approval for currency and price
                    //big, working with the item
                    itemFlow = async(id) => {
                        target = id;

                        var pop = document.getElementById('pop');
                        if(pop.style.display == '' || pop.style.display == 'none'){
                            showPop(1);
                        }
                        var innerHTML = "";
                        if(!connected) {
                            //connect button
                            innerHTML = `
                            <h3>Please Connect your Wallet</h3>
                            <button id="connect" onclick="connectWallet(1)">Connect Wallet</button>
                            `;
                        } else {
                            var accountHash = web3.utils.soliditySha3(accounts[0]);
                            var proof = tree.getHexProof(accountHash);
                            //seller menu
                            if(listings[id].seller == accounts[0]) {
                                
                                innerHTML = `
                                    <h3>This is your listing. Whatsup</h3>
                                    <button onclick="cancelListing(${target})">Cancel Listing</button>
                                    <input id="new-price-input">
                                    <button onclick="editListing(${target})">Edit Price</button>
                                    `;
                            //buyer flow
                            } else {
                                //check allowance
                                let allow = await checkAllowance(listings[target].currency)
                                if(allow >= listings[id].price){
                                    
                                    if(tree.verify(proof,accountHash,root)){
                                        innerHTML = `
                                            <button onclick="buyFriend(${target})">BUY</button>
                                            `;
                                    } else {
                                        innerHTML = `
                                            <button onclick="buy(${target})">BUY</button>
                                            `;
                                    }
                                } else {
                                    innerHTML = `
                                        <h3>Must Approve Currency for Purchase</h3>
                                        <button onclick="setAllowance('${listings[target].currency}','${listings[target].price}')">Approve Coin</button>
                                        `;
                                    console.log('allowance != price');
                                }
                            }
                        }
                        popPop(innerHTML,1);
                    }
                    wizardFlow = async() => {
                        var pop = document.getElementById('pop');
                        if(pop.style.display == '' || pop.style.display == 'none'){
                            showPop(1);
                        }
                        var innerHTML = "";
                        if (!connected) {
                            innerHTML = `
                                <h3>Please Connect your Wallet</h3>
                                <button id="connect" onclick="connectWallet(2)">Connect Wallet</button>
                            `
                        } else {
                            
                            innerHTML = `
                                    <h3>Hiiiiiii ${accounts[0]}</h3>
                                    <h3>Let's create your listing</h3>
                                    
                                        <div>
                                            <label>NFT Token Standard</label>
                                            <input id="erc-input" placeholder="721 or 1155">
                                        </div>
                                        <div>
                                            <label>NFT Collection Contract Address</label>
                                            <input id="collection-input" placeholder="0x0000000000000000000000000000">
                                        </div>
                                        <div>
                                            <label>ERC20 Currency Contract Address</label>
                                            <input id="currency-input" placeholder="0x0000000000000000000000000000">
                                        </div>
                                        <div>
                                            <label>NFT Collection Token Id</label>
                                            <input id="tokenId-input" placeholder="69">
                                        </div>
                                        <div>
                                            <label>Price in Chosen ERC20 (include all decimals)</label>
                                            <input id="price-input" placeholder="100000000">
                                        </div>
                                        <div>
                                            <label>I agree to <a onclick="showTerms()">terms and conditions</a></label>
                                            <input id="terms-input" type="checkbox">
                                        </div>
                                        <div>
                                            <button id="listing-form-button" onclick="createListing()">Create Market Listing</button>
                                        </div>
                                    
                                        `;
                        }
                        popPop(innerHTML,1);
                    }
                    showTerms = () => {
                        var pop = get("pop2");
                        if(pop.style.display == '' || pop.style.display == 'none'){
                            showPop(2);
                        }
                        var innerHTML = "";
                        innerHTML = `
                            <h2>Terms and Conditions</h2>
                            <p>Double check that the url is monygroup.net/raffle</p>
                            <p>Double check that the NFT approval is for what you are trying to sell</p>
                            <p>Double check in the wallet that the create listing interaction is with ${raffleAddress}</p>
                            <p>Consider this a private beta. Maybe use a separate wallet to interact</p>
                            <p>You need to setApprovalAll the contract address. The wizard automatically prompts that transaction first after checking to see if your wallet already has it approved.</p>
                            <p>Your buyer will also need to set their allowance to spend the erc20 with the contract.</p>
                            <p>IT SHOULD WORK but lmk</p>
                            <p>Also by interacting with this contract you agree that Remilia rules and penguins/apes/punks/seals/etc drool</p>
                            <p>Also you affirm that miladystation is an interesting complimentary collection and NOT A GRIFT</p>
                            <p>thank you</p>
                        `
                        popPop(innerHTML,2);
                    }

                    partyFlow = async() => {
                        console.log('lets party');
                        var pop = document.getElementById('pop');
                        if(pop.style.display == '' || pop.style.display == 'none'){
                            showPop(1);
                        }
                        var innerHTML = "";
                        if (!connected) {
                            innerHTML = `
                                <h3>Please Connect your Wallet</h3>
                                <button id="connect" onclick="connectWallet(0)">Connect Wallet</button>
                            `
                            popPop(innerHTML,1);
                        } else {
                            if(friend){
                                innerHTML = `
                                    <h3>Dashboard</h3>
                                    <p>welcome back king, lets give out some party favors</p>
                                    <div>
                                        <div id="props">
                                            <ul>
                                                <li id="time"></li>
                                                <li id="mWin"></li>
                                                <li id="rWin"></li>
                                                <li id="pWin"></li>
                                            </ul>
                                        </div>
                                        
                                        <div id="loading">
                                        <h3>Current Picks</h3>
                                        <div id="winner1">
                                            <h3 id="wallet1">0x00000....</h3>
                                            <p>Status:</p>
                                            <button onclick="addCount(1)">Add Count</button>
                                        </div>
                                        <div id="winner2">
                                            <h3 id="wallet2">0x00000....</h3>
                                            <p>Status:</p>
                                            <button onclick="addCount(2)">Add Count</button>
                                        </div>
                                        <div id="winner3">
                                            <h3 id="wallet3">0x00000....</h3>
                                            <p>Status:</p>
                                            <button onclick="addCount(3)">Add Count</button>
                                        </div>
                                    </div>
                                    `
                                    ;
                            }
                            popPop(innerHTML,0);
                            popProps();
                        }

                    }
                    drawFlow = async() => {

                    }
        </script>

    </body>

    
</html>